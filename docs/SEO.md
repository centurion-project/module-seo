Trait SEO : Add the ability to yours businesses objects to manage HTML's Metas
============================================================================

Trait SEO gives your business objects the ability to support additional fields "Meta / Seo"
to use in the meta tags in the HTML rendering.

This trait has been designed to limit the impact in your business code and to ease its use :
You must only add some traits on your classes for "Rows" and "DbTable models" and,
if you are using "Centurion_Form_Model", on your forms classes.

It has been written in 3 parts :

*   DbTable model to manage and store fields of each business records
*   Some traits to extend Business models and theirs rows to support SEO Fields
*   An helper to populate HTML's meta from SEOtable objects defined by developers

And an additional part to automate the management of SEO fields in Forms and Centurion Backoffice.

This trait supports the translation and the ability "multi-website".

**Before read this documentation, please read the document "README.md" of this module.**


DbTable Model "Seo/Meta"
------------------------

The model `Seo_Model_DbTable_Meta` is the unique model of this module. It is used to store all Meta's value of all objects
of the application. The linked table (called `seo_meta`) has 7 columns :

*   (id : the primary key of each meta value).
*   website_id  : to store a website identifier for each value (to customize Meta values of a same object for several websites).
*   language_id : to store the language of the current value if the object is translatable.
*   model_id    : to store the model of the object (reference to the model `Core/content_type`).
*   record_id   : a hash of the primary key of the record. Its support record with several columns as primary keys.
                  *(The hash is computed on the serialization of primary keys)*
*   type        : the type of the meta (keywords, descriptions, etc...)
*   content     : the content of the meta

###Observations :
It is this model that is responsible to register the multi-website adapter :

*   To register a website adapter, call this **static** method : `Seo_Model_DbTable_Meta::registerWebsiteAdapter($adapter)`.
*   To unregister a website adapter, call this **static** method : `Seo_Model_DbTable_Meta::registerWebsiteAdapter(null)`.
*   To get the current website adapter for SEO, call this **static** method : `Seo_Model_DbTable_Meta::getWebsiteAdapter()`.


Traits SEO
----------

This module contains some traits. To use these traits, read "the document "README.md" :

*   `Seo_Traits_Model_DbTable_Interface` (and `Seo_Traits_Model_DbTable`):
        - Goal      : To define the policy when some Meta's values are not defined to write them from rows' contents.
                      Developers must implement the method `getFieldsToGenerateMeta()` to do it (See the read me).
        - Optional  : Allows developers to customize the list of available for a model and theirs rows.

*   `Seo_Traits_Model_DbTable_Row_Interface` (and `Seo_Traits_Model_DbTable_Row`) :
        - Goal      : To add features to save and get meta's values for a record.
                      Generate automatically metas when their are not defined by the webmaster.
                      This trait is the only element to use the model `Seo/Meta`.

                      If the record has a column called "language_id" (or if the row is translatable and implements the
                      trait Translation_Traits_Model_DbTable_Row_Interface), the trait reuse the current language of
                      the row to save meta values. You can save different values for a same record in several languages.

                      If a website adapter is currently registered in the trait, it is also used to save meta values.

                      If the method to transform

                      **Warning** : If some meta values are not defined for a record when the application gets these values,
                      there are automatically generated. But this is not done in saving !

*   `Seo_Traits_Form_Model_Interface` (and `Seo_Traits_Form_Model`):
        - Goal      : Add automatically all fields to manage Meta fields for a record
                      Populate them for existent records
                      Save them for all records

*   `Seo_Traits_Controller_CRUD_Interface` (and `Seo_Traits_Controller_CRUD`):
        - Goal      : To add automatically all meta fields generated by previous trait in a separate group if the form
                      uses Grid Admin.


Action Helper `Seo_Controller_Action_Helper_SetupMeta`
------------------------------------------------------

The helper is automatically registered by the bootstrap of the module SEO.
It intercepts the signal `on_defining_main_object` sent by the controller (if this controller inherits of
`Centurion_Controller_Action`) when the developer call its method `definingMainObject($object)`

Then, the helper register the main object in a stack. At next postDispatch, the helper add all metas of objects defined
in the stack to the list of meta and clean the stack (to avoid duplicates).


Comments on multi-website ability
---------------------------------

If there is a registered website adapter in this module, the trait returns only records defined for
 this website (aka, website_id must have the value returned by the method `getWebsiteId()` of the adapter).

But, if there are not registered website adapter, the trait returns all records (website_id is ignored).